<div class="talign">
    <div id="vo-tool-sidebar" class="f15p card">
      <div class="content">
        <div class="field">
          <input id="vo-toolbar-sidebar-search" type="text" class="w100p" placeholder="Search characters..." />
        </div>
      </div>
      <div class="content">
        <% for (let avatar of avatars) { %>
          <a id="vo-toolbar-sidebar-avatar-<%= avatar.Id %>"
             class="vo-toolbar-sidebar-avatar secondary dispFlex textAlignLeft"
             href="/character/VO/<%= avatar.NameText.replace(' ', '_') %>"
             role="button">
            <img src="/images/avatar/<%= avatar.IconName %>.png" />
            <span class="spacer10-left"><%= avatar.NameText %></span>
          </a>
        <% } %>
      </div>
    </div>
    <script nonce="<%= req.context.nonce %>">window.avatars = [].concat(<%- JSON.stringify(avatars) %>);</script>
    <% if (avatar) { %>
      <script nonce="<%= req.context.nonce %>">window.avatar = Object.assign({}, <%- JSON.stringify(avatar) %>);</script>
      <script nonce="<%= req.context.nonce %>">window.fetters = Object.assign({}, <%- JSON.stringify(fetters) %>);</script>
    <% } else { %>
      <script nonce="<%= req.context.nonce %>">window.avatar = null;</script>
    <% } %>
    <div id="vo-app" class="f85p">
      <% if (!avatar) { %>
        <div id="vo-app-welcome">
          <div class="card">
            <h2>Welcome to the character VO app</h2>
            <div class="content" style="max-width:800px">
              <p>To get started, select a character.</p>
              <hr class="spacer15-vert" />
              <p class="spacer10-bottom">
                Or if you have an existing VO template, you can paste it below, and it'll identify the character
              from the template parameters.</p>
              <textarea id="welcome-wt-input"
                        class="w100p" style="height:200px; resize: vertical;"
                        placeholder="Enter VO template. You can also paste the entire article and it'll find the correct template."></textarea>
              <div class="buttons valign">
                <button id="welcome-wt-submit" class="primary">Go!</button>
                <div id="welcome-wt-spinner" class="hide loading spacer5-left"></div>
              </div>
            </div>
          </div>
        </div>
      <% } else { %>
        <div id="vo-app-toolbar" class="card alignStretch spacer15-bottom">
          <div class="vo-app-toolbar-charName valign">
            <img src="/images/avatar/<%= avatar.IconName %>.png" />
            <strong><%= avatar.NameText %></strong>
          </div>
          <div class="vo-app-toolbar-buttons valign">
            <div class="vo-app-toolbar-button valign spacer10-left posRel">
              <button id="vo-app-load-button" class="secondary border-light" ui-action="dropdown: #vo-app-load-dropdown">
                <span class="spacer5-right">Load</span>
                <%- icon('chevron-down') %>
              </button>
              <div id="vo-app-load-dropdown" class="ui-dropdown">
                <div id="vo-app-load-fromFetters" class="option" ui-action="close-dropdowns">Load from fetters</div>
                <div id="vo-app-load-fromWikitext" class="option" ui-action="close-dropdowns">Load from wikitext</div>
              </div>
            </div>
            <div class="vo-app-toolbar-button valign spacer10-left posRel">
              <button id="vo-app-language-button" class="secondary border-light" ui-action="dropdown: #vo-app-language-dropdown">
                <span id="vo-app-language-current" class="spacer5-right"><%= cookie('VO-App-LangText', 'English') %></span>
                <%- icon('chevron-down') %>
              </button>
              <div id="vo-app-language-dropdown" class="ui-dropdown">
                <div class="vo-app-language-option option <%= cookieTernary('VO-App-LangCode', {equalsOrEmpty: 'EN', then: 'selected'}) %>"
                     ui-action="close-dropdowns" data-value="EN">English</div>
                <div class="vo-app-language-option option <%= cookieTernary('VO-App-LangCode', {equals: 'CH', then: 'selected'}) %>"
                     ui-action="close-dropdowns" data-value="CH">Chinese</div>
                <div class="vo-app-language-option option <%= cookieTernary('VO-App-LangCode', {equals: 'JP', then: 'selected'}) %>"
                     ui-action="close-dropdowns" data-value="JP">Japanese</div>
                <div class="vo-app-language-option option <%= cookieTernary('VO-App-LangCode', {equals: 'KR', then: 'selected'}) %>"
                     ui-action="close-dropdowns" data-value="KR">Korean</div>
              </div>
            </div>
            <div class="vo-app-toolbar-button valign spacer10-left posRel">
              <button id="vo-app-export-button" class="secondary border-light" ui-action="dropdown: #vo-app-export-dropdown">
                <span class="spacer5-right">Export</span>
                <%- icon('chevron-down') %>
              </button>
              <div id="vo-app-export-dropdown" class="ui-dropdown">
                <div id="vo-app-export-copyText" class="option" ui-action="close-dropdowns">Copy Wikitext</div>
                <div id="vo-app-export-saveFile" class="option" ui-action="close-dropdowns">Save Wikitext to file</div>
                <div class="option-sep"></div>
                <div id="vo-app-export-fetters" class="option" ui-action="close-dropdowns">Export Fetters JSON to file</div>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-list" role="tablist">
          <button role="tab" id="tab-editor" class="tab <%= tab === 'editor' ? 'active' : '' %>"
                  ui-action="tab: #tabpanel-editor, storyTabs; set-query-param: tab=editor">Editor</button>
          <button role="tab" id="tab-wikitext" class="tab <%= tab === 'wikitext' ? 'active' : '' %>"
                  ui-action="tab: #tabpanel-wikitext, storyTabs; set-query-param: tab=wikitext">Wikitext</button>
        </div>
        <div role="tabpanel" aria-labelledby="tab-editor" class="tabpanel <%= tab === 'editor' ? 'active' : 'hide' %>" id="tabpanel-editor">
          <div class="card">
            <div class="content" id="vo-editor">

              <div id="nestedDemo" class="list-group col nested-sortable">
                <div class="list-group-item nested-1"><span class="drag-handle">drag</span> Item 1.1
                  <div class="list-group nested-sortable">
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.1</div>
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.2</div>
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.3</div>
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.4</div>
                  </div>
                </div>
                <div class="list-group-item nested-1"><span class="drag-handle">drag</span> Item 1.2
                  <div class="list-group nested-sortable"></div>
                </div>
                <div class="list-group-item nested-1"><span class="drag-handle">drag</span> Item 1.3
                  <div class="list-group nested-sortable"></div>
                </div>
                <div class="list-group-item nested-1"><span class="drag-handle">drag</span> Item 1.4
                  <div class="list-group nested-sortable">
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.1</div>
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.2</div>
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.3</div>
                    <div class="list-group-item nested-2"><span class="drag-handle">drag</span> Item 2.4</div>
                  </div>
                </div>
                <div class="list-group-item nested-1"><span class="drag-handle">drag</span> Item 1.5
                  <div class="list-group nested-sortable"></div>
                </div>
              </div>

            </div>
          </div>
        </div>
        <div role="tabpanel" aria-labelledby="tab-wikitext" class="tabpanel <%= tab === 'wikitext' ? 'active' : 'hide' %>" id="tabpanel-wikitext">
          <div class="card">
            <div class="content">
              <p class="spacer5-bottom">Any changes made here with be automatically be reflected in the editor, and vice-versa.</p>
              <p class="spacer0-top spacer10-bottom">The syntax highlighting here is not as good as the Fandom Wiki's source editor, maybe I'll make it better later.</p>
              <div id="wikitext-editor" style="width:100%;height:70vh"></div>
            </div>
          </div>
        </div>
      <% } %>
    </div>
</div>